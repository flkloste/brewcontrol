<head>
  <!-- Plotly.js -->
   <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
  <div id="myDiv" style="width: 800px; height: 600px;"><!-- Plotly chart will be drawn inside this DIV --></div>
  
  <font face="arial" size = "14">
  
	Soll-Temperature
	<input id="soll_temp" type="text" name="soll_temp" maxlength="2" size="5">
	<input id="settemp" type="button" value="Set Temp" /> <br> <br>
	Ist-Temperatur <span class="jsValueIstTemp">NaN</span> <br> <br>
	<input id="start_control" type="button" value="Start" />
	<input id="stop_control" type="button" value="Stop" />
	<input id="neu" type="button" value="Neu..." />

	</font>
  <script>
	
	function makeplot() {
	    Plotly.d3.csv("test.csv", function(data){ processData(data) } );

	};
	    
	function processData(allRows) {

	    console.log(allRows);
	    var date = [], ist = [], soll = [];

	    for (var i=0; i<allRows.length; i++) {
		
		row = allRows[i];
		date.push( row['Zeit'] );
		ist.push( row['Ist'] );
		soll.push( row['Soll'] );
	    }
	    makePlotly( date, ist, soll );
	}

	function makePlotly( x, y, z ){
	    var plotDiv = document.getElementById("plot");
		
		var layout = {
			xaxis: {
				type: 'date'		
			}
		};
		
		var trace0 = {
		  x: x,
		  y: y,
		  name: 'Ist',
		  type: 'scatter'
		};
		var trace1 = {
		  x: x,
		  y: z,
		  name: 'Soll',
		  type: 'scatter'
		};
		
		var traces = [trace0, trace1];

	    Plotly.newPlot('myDiv', traces, layout);
	};
	
	function updateTemperature() {
		var $jsValueIst = document.querySelector('.jsValueIstTemp');
		
		var jqXHR = $.ajax({
			type: "POST",
			url: "get_info",
			async: true,
			dataType: "json",
			data: { },
			success: function (json) {
				var x = json.ist;
				$jsValueIst.innerHTML = x;
			}
		});
		
		
	}
    
	makeplot();
	setInterval(makeplot, 5000);
	setInterval(updateTemperature, 1000);
  </script>



<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
<script>

    $(document).ready(function() {
	    $("#settemp").click(function(){
	        var soll_temp_value = document.getElementById('soll_temp').value;
      		var jqXHR = $.ajax({
	  	        type: "POST",
	     		url: "set_temp",
	        	async: true,
            	data: { mydata: soll_temp_value }
        	});
   	    }); 
		$("#neu").click(function(){
      		var jqXHR = $.ajax({
	  	        type: "POST",
	     		url: "neu",
	        	async: true,
            	data: { }
        	});
   	    }); 
		$("#start_control").click(function(){
      		var jqXHR = $.ajax({
	  	        type: "POST",
	     		url: "start",
	        	async: true,
           		data: { }
        	});
   	    });
		$("#stop_control").click(function(){
      		var jqXHR = $.ajax({
	  	        type: "POST",
	     		url: "stop",
	        	async: true,
            	data: { }
        	});
   	    }); 		
    });
</script>




</body>

